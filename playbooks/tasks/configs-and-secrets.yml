- set_fact:
    config_values:
      redis_hostname: redis-master
      elasticsearch_host: job-market-analyzer-es-http
    secrets:
      elasticsearch_username: "{{ lookup('aws_ssm', '/job-market-analyzer/' + env + '/elasticsearch/username', region='ap-southeast-2')}}"
      elasticsearch_password: "{{ lookup('aws_ssm', '/job-market-analyzer/' + git_branch + '/elasticsearch/password', region='ap-southeast-2')}}"
      redis_password: "{{ lookup('aws_ssm', '/job-market-analyzer/' + env + '/redis/password', region='ap-southeast-2')}}"
      encryption_key: "{{ lookup('aws_ssm', '/job-market-analyzer/' + env + '/encryption-key', region='ap-southeast-2')}}"
      default_iv: "{{ lookup('aws_ssm', '/job-market-analyzer/' + env + '/default-iv', region='ap-southeast-2')}}"

- set_fact:
    api:
      config_values:
        REDIS_HOST: "{{ config_values.redis_hostname }}"
        ELASTICSEARCH_HOST: "{{ config_values.elasticsearch_host }}"
      secrets:
        REDIS_PASSWORD: "{{ secrets.redis_password }}"
        ELASTICSEARCH_USERNAME: "{{ secrets.elasticsearch_username }}"
        ELASTICSEARCH_PASSWORD: "{{ secrets.elasticsearch_password }}"
        ENCRYPTION_KEY: "{{ secrets.encryption_key }}"
        DEFAULT_IV: "{{ secrets.default_iv }}"